#!/bin/sh
#-*-sh-*-

#
# Copyright © 2009 CNRS, INRIA, Université Bordeaux 1
# See COPYING in top-level directory.
#

: ${TMPDIR=/tmp}
{
  tmp=`
    (umask 077 && mktemp -d "$TMPDIR/fooXXXXXX") 2>/dev/null
  ` &&
  test -n "$tmp" && test -d "$tmp"
} || {
  tmp=$TMPDIR/foo$$-$RANDOM
  (umask 077 && mkdir "$tmp")
} || exit $?
file="$tmp/lstopo_xml.output.xml"

set -e
../utils/lstopo --xml "$srcdir"/linux/16em64t-4s2c2t.xml.tar.gz.output "$file"
diff @HWLOC_DIFF_U@ "$srcdir"/linux/16em64t-4s2c2t.xml.tar.gz.output "$file"
if [ -n "@XMLLINT@" ]
then
  cp "$srcdir"/../src/lstopo.dtd "$tmp/"
  @XMLLINT@ --valid "$file" > /dev/null
fi
rm -rf "$tmp"
